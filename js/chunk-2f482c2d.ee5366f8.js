(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2f482c2d"],{"01c8":function(t,e,a){"use strict";a("868e")},"1d56":function(t,e,a){},"1e95":function(t,e,a){"use strict";a("1d56")},"223b":function(t,e,a){},2797:function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("transition",{attrs:{name:"fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}]},[a("div",{staticClass:"modal show reply-modal",attrs:{tabindex:"-1",role:"dialog"},on:{click:function(e){return e.target!==e.currentTarget?null:t.close.apply(null,arguments)}}},[a("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[a("icon",{staticClass:"icon-close cursor-pointer",attrs:{"icon-name":"cross"},nativeOn:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.close.apply(null,arguments)}}})],1),a("div",{staticClass:"modal-body"},[a("section",{staticClass:"tweet-container"},[a("section",{staticClass:"avatar-part"},[a("UserThumbnail",{attrs:{"initial-user":t.tweet.userData?t.tweet.userData:{}}}),a("div",{staticClass:"vertical-bar"})],1),a("section",{staticClass:"content-part"},[a("div",{staticClass:"title-part"},[a("div",{staticClass:"user-name",attrs:{title:t.tweet.userData?t.emptyName(t.tweet.userData.name,t.tweet.userData.account):""}},[t._v(" "+t._s(t.tweet.userData?t.emptyName(t.tweet.userData.name,t.tweet.userData.account):"")+" ")]),a("div",{staticClass:"account-and-time"},[t._v(" "+t._s(t._f("addPrefix")(t.tweet.userData?t.tweet.userData.account:""))+"・"+t._s(t._f("timeFormat")(t.tweet.createdAt))+" ")])]),a("div",{staticClass:"description"},[t._v(" "+t._s(t.tweet.description)+" ")]),a("div",{staticClass:"reply-to"},[a("span",{staticClass:"text"},[t._v("回覆")]),a("span",{staticClass:"account"},[t._v(t._s(t._f("addPrefix")(t.tweet.userData?t.tweet.userData.account:"")))])])])]),a("section",{staticClass:"reply-input-box"},[a("section",{staticClass:"avatar-part"},[a("UserThumbnail",{attrs:{"initial-user":t.currentUser}})],1),a("section",{staticClass:"input-part"},[a("textarea",{directives:[{name:"model",rawName:"v-model.trim.lazy",value:t.comment,expression:"comment",modifiers:{trim:!0,lazy:!0}}],attrs:{placeholder:"推你的回覆",maxlength:"140"},domProps:{value:t.comment},on:{change:function(e){t.comment=e.target.value.trim()},blur:function(e){return t.$forceUpdate()}}}),t._v(" "),a("div",{staticClass:"control-part"},[a("span",{staticClass:"error-message",attrs:{title:"error"}},[t._v(t._s(t.error))]),a("button",{staticClass:"btn-control btn-reply",attrs:{disabled:t.isProcessing},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.reply.apply(null,arguments)}}},[t._v(" 回覆 ")])])])])])])])]),a("div",{staticClass:"modal-backdrop show"})])])},s=[],n=a("1da1"),i=a("5530"),c=(a("96cf"),a("d9e2"),a("b0c0"),a("d092")),o=a("2708"),u=a("6783"),l=a("2f62"),d=a("2fa3"),p={components:{UserThumbnail:c["a"]},mixins:[o["c"],o["b"],o["a"],o["d"],o["e"]],props:{show:{type:Boolean,required:!0,default:!1},tweet:{type:Object,required:!0,default:function(){}}},data:function(){return{comment:"",error:"",isProcessing:!1}},computed:Object(i["a"])({},Object(l["b"])(["currentUser"])),methods:{reply:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var a,r,s,n,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,a=t.checkTweet(t.comment),r=a.status,s=a.message,t.error="",!1!==r){e.next=6;break}return t.error=s,e.abrupt("return");case 6:return t.isProcessing=!0,e.next=9,u["a"].postReply({tweetId:t.tweet.id,comment:t.comment});case 9:if(n=e.sent,c=n.data,"success"===c.status){e.next=13;break}throw new Error(c.message);case 13:t.$emit("after-reply",t.tweet.id),console.log(t.tweet),t.handleNewReply({id:(new Date).valueOf(),comment:t.comment,replyerData:Object(i["a"])({},t.currentUser),tweetId:(new Date).valueOf(),tweetOwnerId:t.tweet.userData.id,tweetOwnerAccount:t.tweet.userData.account,createdAt:new Date}),e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](0),d["a"].fire({icon:"error",title:"回覆失敗，請稍後再試"});case 21:return e.prev=21,t.isProcessing=!1,e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[0,18,21,24]])})))()},handleNewReply:function(t){var e=this.$route;"tweet"===e.name&&(this.$store.commit("produceReply",t),this.close()),this.close()},close:function(){this.comment="",this.error="",this.$emit("close")}}},w=p,m=(a("1e95"),a("2877")),f=Object(m["a"])(w,r,s,!1,null,"37f518cc",null);e["a"]=f.exports},6783:function(t,e,a){"use strict";a("a4d3"),a("e01a");var r=a("2fa3");e["a"]={get:function(t){var e=t.tweetId;return r["b"].get("/tweets/".concat(e))},getAll:function(){return r["b"].get("/tweets")},getReplies:function(t){var e=t.tweetId;return r["b"].get("/tweets/".concat(e,"/replies"))},post:function(t){var e=t.description;return r["b"].post("/tweets",{description:e})},postReply:function(t){var e=t.tweetId,a=t.comment;return r["b"].post("/tweets/".concat(e,"/replies"),{comment:a})},like:function(t){var e=t.tweetId;return r["b"].post("/tweets/".concat(e,"/like"))},unlike:function(t){var e=t.tweetId;return r["b"].post("/tweets/".concat(e,"/unlike"))}}},"868e":function(t,e,a){},a9eb:function(t,e,a){},b17a:function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("router-link",{staticClass:"tweet-container cursor-pointer",attrs:{to:{name:"tweet",params:{id:t.tweet.id}},custom:""},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.navigate;return[a("div",{on:{click:r}},[a("section",{staticClass:"avatar-part"},[a("UserThumbnail",{attrs:{"initial-user":t.tweet.userData}})],1),a("section",{staticClass:"content-part"},[a("div",{staticClass:"title-part"},[a("div",{staticClass:"user-name",attrs:{title:t.emptyName(t.tweet.userData.name,t.tweet.userData.account)}},[t._v(" "+t._s(t.emptyName(t.tweet.userData.name,t.tweet.userData.account))+" ")]),a("div",{staticClass:"account-and-time"},[t._v(" "+t._s(t._f("addPrefix")(t.tweet.userData.account))+"・"+t._s(t._f("timeFormat")(t.tweet.createdAt))+" ")])]),a("div",{staticClass:"description"},[t._v(" "+t._s(t.tweet.description)+" ")]),a("div",{staticClass:"control-group"},[a("div",{staticClass:"control-container"},[a("span",{staticClass:"event-area"},[a("icon",{staticClass:"control-icon",attrs:{"icon-name":"reply"},nativeOn:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.openReplyModal.apply(null,arguments)}}}),a("span",{staticClass:"control-statistic"},[t._v(t._s(t._f("numberFormat")(t.tweet.replyAmount)))])],1)]),a("div",{staticClass:"control-container"},[!1===t.tweet.userLiked?a("icon",{staticClass:"control-icon cursor-pointer icon-like",attrs:{"icon-name":"like"},nativeOn:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.like(t.tweet.id)}}}):a("icon",{staticClass:"control-icon cursor-pointer icon-like-checked",attrs:{"icon-name":"like-checked"},nativeOn:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.unlike(t.tweet.id)}}}),a("span",{staticClass:"control-statistic"},[t._v(t._s(t._f("numberFormat")(t.tweet.likeAmount)))])],1)])])])]}}])})},s=[],n=a("1da1"),i=a("5530"),c=(a("96cf"),a("d9e2"),a("d092")),o=a("2708"),u=a("6783"),l=a("2fa3"),d={components:{UserThumbnail:c["a"]},mixins:[o["b"],o["a"],o["d"],o["e"]],props:{initialTweet:{type:Object,required:!0}},data:function(){return{tweet:{},isProcessing:!1}},watch:{initialTweet:{handler:function(t,e){this.tweet=Object(i["a"])(Object(i["a"])({},this.tweet),t)},deep:!0}},created:function(){this.tweet=Object(i["a"])(Object(i["a"])({},this.tweet),this.initialTweet)},methods:{like:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!e.isProcessing){a.next=3;break}return l["a"].fire({icon:"warning",title:"請稍後再試"}),a.abrupt("return");case 3:return e.isProcessing=!0,a.prev=4,a.next=7,u["a"].like({tweetId:t});case 7:if(r=a.sent,s=r.data,"success"===s.status){a.next=11;break}throw new Error(s.message);case 11:e.tweet.userLiked=!0,e.tweet.likeAmount+=1,a.next=18;break;case 15:a.prev=15,a.t0=a["catch"](4),l["a"].fire({icon:"error",title:"無法like推文，請稍後再試"});case 18:return a.prev=18,e.isProcessing=!1,a.finish(18);case 21:case"end":return a.stop()}}),a,null,[[4,15,18,21]])})))()},unlike:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!e.isProcessing){a.next=3;break}return l["a"].fire({icon:"warning",title:"請稍後再試"}),a.abrupt("return");case 3:return e.isProcessing=!0,a.prev=4,a.next=7,u["a"].unlike({tweetId:t});case 7:if(r=a.sent,s=r.data,"success"===s.status){a.next=11;break}throw new Error(s.message);case 11:e.tweet.userLiked=!1,e.tweet.likeAmount-=1,a.next=18;break;case 15:a.prev=15,a.t0=a["catch"](4),l["a"].fire({icon:"error",title:"無法unlike推文，請稍後再試"});case 18:return a.prev=18,e.isProcessing=!1,a.finish(18);case 21:case"end":return a.stop()}}),a,null,[[4,15,18,21]])})))()},openReplyModal:function(){this.$emit("open-reply-modal",this.tweet)}}},p=d,w=(a("fe66"),a("2877")),m=Object(w["a"])(p,r,s,!1,null,"c99ac40e",null);e["a"]=m.exports},d092:function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("router-link",{staticClass:"photo-container",attrs:{to:{name:"user-main",params:{id:t.user.id}}}},[a("img",{directives:[{name:"show",rawName:"v-show",value:t.user.avatar,expression:"user.avatar"}],attrs:{src:t.user.avatar},on:{error:function(e){t.user.avatar=""}}})])},s=[],n=a("5530"),i={props:{initialUser:{type:Object,required:!0}},data:function(){return{user:{id:-1,avatar:""}}},watch:{initialUser:function(t){this.user=Object(n["a"])(Object(n["a"])({},this.user),t)}},created:function(){this.user=Object(n["a"])(Object(n["a"])({},this.user),this.initialUser)}},c=i,o=(a("01c8"),a("2877")),u=Object(o["a"])(c,r,s,!1,null,"34e062da",null);e["a"]=u.exports},d1fb:function(t,e,a){"use strict";a("a9eb")},ded4:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"tab-container"},[a("portal",{attrs:{to:"modals"}},[a("ReplyModal",{attrs:{order:4,show:t.show,tweet:t.modalTweet},on:{"after-reply":function(e){return t.afterReplyHandler(e)},close:t.closeModal}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.isLoading,expression:"!isLoading"}],staticClass:"tweet-list"},[t._l(t.sortedTweets,(function(e){return a("Tweet",{key:e.id,attrs:{"initial-tweet":e},on:{"open-reply-modal":function(e){return t.openReplyModal(e)}}})})),a("h1",{directives:[{name:"show",rawName:"v-show",value:!1===t.isLoading&&0===t.sortedTweets.length,expression:"isLoading === false && sortedTweets.length === 0"}],staticClass:"default-text"},[t._v(" 尚無喜歡的內容 ")])],2)],1)},s=[],n=a("5530"),i=a("1da1"),c=(a("96cf"),a("d9e2"),a("d81d"),a("b17a")),o=a("2797"),u=a("2fa3"),l=a("4cce"),d={components:{ReplyModal:o["a"],Tweet:c["a"]},data:function(){return{tweets:[],isLoading:!0,show:!1,modalTweet:{}}},beforeRouteUpdate:function(t,e,a){var r=t.params.id;this.fetchTweets(r),a()},computed:{sortedTweets:function(){return Object(u["c"])(this.tweets,"relationshipCreatedAt")}},created:function(){var t=this.$route.params.id;this.fetchTweets(t)},methods:{fetchTweets:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,e.isLoading=!0,a.next=4,l["a"].getUserLikes({userId:t});case 4:if(r=a.sent,"OK"===r.statusText){a.next=7;break}throw new Error(r.statusText);case 7:s=r.data,s=s.map((function(t){return Object(n["a"])(Object(n["a"])({},t),{},{id:t.TweetId})})),e.tweets=s,e.isLoading=!1,a.next=16;break;case 13:a.prev=13,a.t0=a["catch"](0),u["a"].fire({icon:"error",title:"無法取得推文，請稍後再試"});case 16:case"end":return a.stop()}}),a,null,[[0,13]])})))()},openReplyModal:function(t){this.show=!0,this.modalTweet=t},closeModal:function(){this.show=!1},afterReplyHandler:function(t){this.tweets=this.tweets.map((function(e){return e.id===t&&(e.replyAmount=e.replyAmount+1),e}))}}},p=d,w=(a("d1fb"),a("2877")),m=Object(w["a"])(p,r,s,!1,null,"b076e628",null);e["default"]=m.exports},fe66:function(t,e,a){"use strict";a("223b")}}]);
//# sourceMappingURL=chunk-2f482c2d.ee5366f8.js.map